"use strict";(self.webpackChunkillium_documentation=self.webpackChunkillium_documentation||[]).push([[2972],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=n.createContext({}),o=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=o(e.components);return n.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=o(a),k=i,d=m["".concat(p,".").concat(k)]||m[k]||u[k]||r;return a?n.createElement(d,s(s({ref:t},c),{},{components:a})):n.createElement(d,s({ref:t},c))}));function d(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,s=new Array(r);s[0]=k;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[m]="string"==typeof e?e:i,s[1]=l;for(var o=2;o<r;o++)s[o]=a[o];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},6666:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>o});var n=a(7462),i=(a(7294),a(3905));const r={sidebar_position:3,description:"Examples of basic scripts"},s="Scripts",l={unversionedId:"developers/scripts",id:"developers/scripts",title:"Scripts",description:"Examples of basic scripts",source:"@site/docs/developers/scripts.md",sourceDirName:"developers",slug:"/developers/scripts",permalink:"/docs/developers/scripts",draft:!1,editUrl:"https://github.com/project-illium/illium-documentation/docs/developers/scripts.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,description:"Examples of basic scripts"},sidebar:"devSidebar",previous:{title:"Concept Review",permalink:"/docs/developers/concept_review"},next:{title:"Locktime",permalink:"/docs/developers/locktime"}},p={},o=[{value:"Parameters",id:"parameters",level:2},{value:"Examples",id:"examples",level:2},{value:"Password Script",id:"password-script",level:3},{value:"Multisig Script",id:"multisig-script",level:3},{value:"Timelock script",id:"timelock-script",level:3},{value:"Hash Timelock Contract",id:"hash-timelock-contract",level:3},{value:"HODL Vault",id:"hodl-vault",level:3}],c={toc:o},m="wrapper";function u(e){let{components:t,...a}=e;return(0,i.kt)(m,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"scripts"},"Scripts"),(0,i.kt)("p",null,"Let's turn our attention back to the script. All unlocking scripts are written in a language called Lurk and share the same\nsignature of a lambda function with a specific set of parameters."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n      ;; Must return t (true) or nil (false)\n)\n")),(0,i.kt)("p",null,"Notice the ",(0,i.kt)("inlineCode",{parentName:"p"},"script-params")," parameter. This is the same ",(0,i.kt)("inlineCode",{parentName:"p"},"params")," that was committed to as part of the ",(0,i.kt)("inlineCode",{parentName:"p"},"scriptHash")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"scritHash = hash(lurkCommitment || params)\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"params")," that are committed to will ultimately get passed in to the unlocking function when the utxo is being\nspent and the script will have an opportunity to evaluate the arguments."),(0,i.kt)("p",null,"Consider the following script:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n      (check-sig (car unlocking-params) (car script-params) (nth 7 public-params))\n)\n")),(0,i.kt)("p",null,"This script handles a basic transfer. The ",(0,i.kt)("inlineCode",{parentName:"p"},"params")," that is committed to is a public key and the script verifies\na digital signature covering the transaction's ",(0,i.kt)("inlineCode",{parentName:"p"},"sighash")," against the committed public key."),(0,i.kt)("p",null,"The signature gets passed into the script via the ",(0,i.kt)("inlineCode",{parentName:"p"},"unlocking-params")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"sighash")," gets passed in by the circuit via\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"public-params"),"."),(0,i.kt)("p",null,"If we wanted to we could have just hard-coded the public key inside the script instead of putting it in the params."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n      (check-sig (car unlocking-params) 79877116396000796934016162317696488904839608298135655275973165100101729765931 (nth 7 public-params))\n)\n")),(0,i.kt)("p",null,"This works just fine, but it's generally preferred to put variables like this in the ",(0,i.kt)("inlineCode",{parentName:"p"},"params")," field instead of hard-coding\nthem so scripts can be shared and reused easily without having to edit them."),(0,i.kt)("h2",{id:"parameters"},"Parameters"),(0,i.kt)("p",null,"The parameters to the unlocking function are as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"script-params")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): The list of parameters committed to in the script-hash."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"unlocking-params")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): A list of unlocking parameters provided when creating the transaction's proof and spending the utxo. If the unlocking parameters make the function return ",(0,i.kt)("inlineCode",{parentName:"li"},"True"),", the funds can move."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"input-index")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The index of the input in the transaction currently being evaluated."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"private-params")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"cons"),"): A cons cell containing two elements \u2015 a list of ",(0,i.kt)("inlineCode",{parentName:"li"},"private-input"),"s and a list of ",(0,i.kt)("inlineCode",{parentName:"li"},"private-output"),"s.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"private-input")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"script-commitment")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"commitment"),"): The hash of this script being evaluated."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"amount")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"u64"),"): The amount of coins or tokens of this utxo."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"asset-id")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The asset ID of the utxo."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"script-params")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): The same script-params above."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"commitment-index")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The index of the utxo in the transaction output commitment set."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"state")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): The utxo's state field."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"salt")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The utxo's salt field."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"unlocking-params")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): The same unlocking-params above."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"inclusion-proof-hashes")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): A list of (",(0,i.kt)("inlineCode",{parentName:"li"},"num"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"bool"),") cons cells representing the inclusion proof linking the output commitment to the transaction's merkle root."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"inclusion-proof-accumulator")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): A list of ",(0,i.kt)("inlineCode",{parentName:"li"},"num")," hashes that represent the preimage of the transactions' merkle root."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"private-output")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"script-hash")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The output's script-hash."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"amount")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"u64"),"): The output's amount."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"asset-id")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The asset ID of the output."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"state")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): The output's state field."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"salt")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The output's salt field."))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"public-params")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): A list of public parameters. These are all pulled from the body of the transaction as\nseen by the network.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"nullifiers")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): A list of ",(0,i.kt)("inlineCode",{parentName:"li"},"num")," nullifiers from the transaction."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"txo-root")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The tranaction's txo-root."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"fee")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"u64"),"): The fee paid by the transaction."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"coinbase")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"u64"),"): The amount of new coins created by the transaction. This only applies to coinbase transactions. It will\nbe zero for all others."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"mint-id")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): If this is a token mint transaction, this is the ID of the token being minted. It will be ",(0,i.kt)("inlineCode",{parentName:"li"},"nil")," otherwise."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"mint-amount")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"u64"),"): This is the amount of tokens being minted if this is a token mint transaction."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"public-outputs")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"): A list of cons cells of format (",(0,i.kt)("inlineCode",{parentName:"li"},"num"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"list"),"). Representing the outputput commitment and\nciphertext respectively."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"sighash")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The transaction's sighash."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"locktime")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The transaction's locktime field."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"locktime-precision")," (type ",(0,i.kt)("inlineCode",{parentName:"li"},"num"),"): The transaction's locktime precision field.")))),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("h3",{id:"password-script"},"Password Script"),(0,i.kt)("p",null,"A user can spend the utxo if they know the password. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"script-params = (<large_random_secret_number>)\nunlocking-params = (<large_random_secret_number>)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n      (= (car unlocking-params) (car script-params))\n)\n")),(0,i.kt)("h3",{id:"multisig-script"},"Multisig Script"),(0,i.kt)("p",null,"This is an example of a 2 of 3 multisig. If 2 out of 3 key holders sign the transaction, the funds will unlock."),(0,i.kt)("p",null,"The committed script params contains the threshold and a list of public keys."),(0,i.kt)("p",null,"The unlocking params contains a list of booleans which controls which public keys are used in the validation plus\nenough signatures to meet the threshold."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"script-params = (<threshold> <pubkey0-x> <pubkey0-y> <pubkey1-x> <pubkey1-y> <pubkey2-x> <pubkey2-y>)\n                 \nunlocking-params ((1 0 1) <sig0> <sig2>)\n                 \n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n        !(import std/crypto)\n\n        !(def threshold (car script-params))\n        !(def key-selector (car unlocking-params))\n        !(def pubkeys (cdr script-params))\n        !(def sigs (cdr unlocking-params))\n\n        !(defun validate-sigs (selector key-idx sig-idx valid-sigs) (\n                (if (= (car selector) 1)\n                    (if (check-sig (nth sig-idx sigs) (cons (nth key-idx pubkeys) (nth (+ key-idx 1) pubkeys)) !(param sighash))\n                        (validate-sigs (cdr selector) (+ key-idx 2) (+ sig-idx 1) (+ valid-sigs 1))\n                        nil\n                    )\n                    (if (cdr selector)\n                        (validate-sigs (cdr selector) (+ key-idx 2) sig-idx valid-sigs)\n                        (>= valid-sigs threshold)\n                    )\n                )\n        ))\n\n        (validate-sigs key-selector 0 0 0)\n)\n")),(0,i.kt)("h3",{id:"timelock-script"},"Timelock script"),(0,i.kt)("p",null,"Coins cannot be spent until after a certain time has past."),(0,i.kt)("p",null,"The script-params contain the locktime and a public key. The unlocking-params a signature."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"script-params = (<lock-until-timestamp> <pubkey>)\nunlocking-params = (<signature>)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n        !(assert (<= !(param locktime-precision) 120))\n        !(assert (> !(param locktime) (car script-params))\n        !(assert (check-sig (car unlocking-params) (car (cdr script-params)) !(param sighash)))\n        t\n)\n")),(0,i.kt)("h3",{id:"hash-timelock-contract"},"Hash Timelock Contract"),(0,i.kt)("p",null,"Alice can spend the coins at any time by revealing a hash preimage.\nBob can spend the coins after a timelock expires with his public key."),(0,i.kt)("p",null,"The script-params contain the locktime, hash, and public key.\nThe unlocking-params a signature or hash preimage and a control bit."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"script-params = (<lock-until-timestamp> <hash> <bob-pubkey>)\n                              \nunlocking-params = (t <hash-preimage>)\nor\nunlocking-params = (nil <signature>)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n        !(defun validate-hash () (\n                (= (hash (car (cdr unlocking-params))) (car (cdr script-params)))\n        ))\n        \n        !(defun validate-sig () (\n                !(assert (<= !(param locktime-precision) 120))\n                !(assert (> !(param locktime) (car script-params))\n                !(assert (check-sig (car (cdr unlocking-params)) (car (cdr (cdr script-params))) !(param sighash)))\n                t\n        ))\n\n       (if (car unlocking-params)\n           (validate-hash)\n           (validate-sig)\n       )\n)\n")),(0,i.kt)("h3",{id:"hodl-vault"},"HODL Vault"),(0,i.kt)("p",null,"Funds can only be spent after a third party price oracle signs a message attesting to the\nillium dollar exchange rate reaching a certain amount. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"script-params = (<exchange-rate-target> <oracle-pubkey> <spend-pubkey>)\nunlocking-params = (<exchange-rate> <oracle-signature> <spend-signature>)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lisp"},"(lambda (script-params unlocking-params input-index private-params public-params)\n        !(assert (>= (car unlocking-params) (car script-params)))\n        !(assert (check-sig (car (cdr unlocking-params)) (car (cdr script-params)) (car unlocking-params)))\n        !(assert (check-sig (car (cdr (cdr unlocking-params))) (car (cdr (cdr script-params))) !(param sighash)))\n        t\n)\n")))}u.isMDXComponent=!0}}]);